<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI CAD</title>
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; font-family: Arial, sans-serif; background: #0b0d10; color: #e8e8e8; overflow: hidden; }

      .layout {
        display: grid;
        grid-template-columns: 130px 1fr 300px;
        grid-template-rows: 1fr 80px 28px;
        height: 100vh;
      }

      /* å·¦ç¸¦ãƒ„ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
      #tool-panel {
        grid-column: 1;
        grid-row: 1 / 3;
        background: #14181d;
        border-right: 1px solid #2b2f33;
        overflow-y: auto;
        padding: 6px 4px;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }


      #layer-panel {
        border: 1px solid #2b2f33;
        border-radius: 4px;
        padding: 6px;
        margin: 2px 2px 8px;
        background: #101419;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .layer-title { font-size: 11px; color: #8aa8c0; font-weight: bold; }
      .layer-lang-row,
      .layer-current-row,
      .layer-create-row,
      .layer-state-row { display: flex; gap: 6px; align-items: center; }
      .layer-lang-row label,
      .layer-current-row label { font-size: 10px; color: #6a7480; min-width: 44px; }
      .layer-lang-select,
      .layer-current-select,
      .layer-name-input {
        flex: 1;
        background: #0b0d10;
        border: 1px solid #3a4450;
        color: #e8e8e8;
        border-radius: 3px;
        font-size: 11px;
        padding: 2px 4px;
      }
      .layer-add-btn {
        border: 1px solid #3f464d;
        background: #1b2026;
        color: #e8e8e8;
        border-radius: 3px;
        font-size: 11px;
        padding: 3px 6px;
        cursor: pointer;
      }
      .layer-list-header,
      .layer-row {
        display: grid;
        grid-template-columns: 1fr 40px 80px 56px 28px 28px;
        gap: 4px;
        align-items: center;
      }
      .layer-list-header { font-size: 9px; color: #6a7480; }
      .layer-list { display: flex; flex-direction: column; gap: 2px; max-height: 140px; overflow: auto; }
      .layer-name-btn {
        border: 1px solid #2f3740;
        background: #151a20;
        color: #d8e2ee;
        border-radius: 3px;
        padding: 2px 4px;
        font-size: 10px;
        text-align: left;
        cursor: pointer;
      }
      .layer-row.active .layer-name-btn { border-color: #4da6ff; color: #4da6ff; }

      .layer-color-input {
        width: 100%;
        height: 22px;
        border: 1px solid #2f3740;
        background: #151a20;
        border-radius: 3px;
        padding: 0;
      }
      .layer-linetype-select {
        width: 100%;
        background: #0b0d10;
        border: 1px solid #3a4450;
        color: #d8e2ee;
        border-radius: 3px;
        font-size: 10px;
        padding: 2px;
      }
      .layer-width-input {
        width: 100%;
        background: #0b0d10;
        border: 1px solid #3a4450;
        color: #d8e2ee;
        border-radius: 3px;
        font-size: 10px;
        padding: 2px;
      }
      .layer-toggle {
        border: 1px solid #2f3740;
        background: #151a20;
        color: #d8e2ee;
        border-radius: 3px;
        padding: 1px;
        font-size: 11px;
        cursor: pointer;
      }
      .layer-toggle.off { opacity: 0.55; }
      .tool-group-label {
        font-size: 9px;
        color: #6a7480;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 6px 6px 2px;
        border-top: 1px solid #2b2f33;
        margin-top: 4px;
      }
      .tool-group-label:first-child { border-top: none; margin-top: 0; }

      .tool-btn {
        border: 1px solid #3f464d;
        background: #1b2026;
        color: #e8e8e8;
        border-radius: 4px;
        padding: 5px 6px;
        cursor: pointer;
        font-size: 11px;
        text-align: left;
        line-height: 1.3;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .tool-btn:hover { background: #222b35; border-color: #5a6470; }
      .tool-btn.active { background: #2554a8; border-color: #4975c2; }
      .tool-btn .key-hint {
        margin-left: auto;
        font-size: 9px;
        color: #6a7480;
        font-family: monospace;
      }
      .tool-btn.active .key-hint { color: #9ab0d0; }

      /* CADã‚­ãƒ£ãƒ³ãƒã‚¹ */
      #cad-root {
        grid-column: 2;
        grid-row: 1;
        position: relative;
        overflow: hidden;
      }

      /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ ã‚¿ãƒ– */
      .sidebar-tabs {
        display: flex;
        border-bottom: 1px solid #2b2f33;
        background: #0d1117;
        flex-shrink: 0;
      }
      .sidebar-tab {
        flex: 1;
        padding: 7px 4px;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        color: #6a7480;
        font-size: 11px;
        cursor: pointer;
        white-space: nowrap;
      }
      .sidebar-tab:hover { color: #c0d0e0; }
      .sidebar-tab.active { color: #4da6ff; border-bottom-color: #4da6ff; }

      .sidebar-tab-content { display: none; flex-direction: column; flex: 1; overflow: hidden; }
      .sidebar-tab-content.active { display: flex; }

      /* è¨­å®šã‚¿ãƒ– */
      .settings-section {
        padding: 10px 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        overflow-y: auto;
        flex: 1;
      }
      .settings-title {
        font-size: 12px;
        color: #9ecbff;
        font-weight: bold;
        margin-bottom: 4px;
      }
      .settings-note {
        font-size: 10px;
        color: #556070;
        margin-bottom: 6px;
      }
      .settings-label {
        font-size: 11px;
        color: #8aa8c0;
        display: flex;
        flex-direction: column;
        gap: 3px;
      }
      .settings-label input {
        background: #0b0d10;
        border: 1px solid #3a4450;
        color: #e8e8e8;
        border-radius: 3px;
        padding: 4px 6px;
        font-size: 11px;
        font-family: monospace;
      }
      .settings-save-btn {
        align-self: flex-end;
        background: #1e3a5f;
        border: 1px solid #2a5080;
        color: #7abfff;
        border-radius: 3px;
        padding: 3px 10px;
        font-size: 11px;
        cursor: pointer;
        margin-bottom: 8px;
      }
      .settings-save-btn:hover { background: #254870; }

      /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆAI ãƒãƒ£ãƒƒãƒˆï¼‰*/

      #property-panel {
        display: none;
        border-bottom: 1px solid #2b2f33;
        padding: 8px;
        background: #11161c;
      }
      .prop-header { font-size: 12px; color: #9ecbff; margin-bottom: 6px; font-weight: bold; }
      .prop-grid, .prop-geo-grid {
        display: grid;
        grid-template-columns: 52px 1fr;
        gap: 4px 6px;
        align-items: center;
        margin-bottom: 8px;
      }
      .prop-grid input, .prop-grid select, .prop-geo-grid input {
        width: 100%;
        background: #0f1216;
        border: 1px solid #343a40;
        color: #e8e8e8;
        border-radius: 3px;
        font-size: 11px;
        padding: 3px 5px;
      }
      .prop-note { font-size: 11px; color: #8aa8c0; margin-bottom: 8px; }
      #prop-apply {
        width: 100%;
        border: 1px solid #3f464d;
        background: #1b2026;
        color: #e8e8e8;
        border-radius: 4px;
        padding: 6px;
        cursor: pointer;
      }
      .sidebar {
        grid-column: 3;
        grid-row: 1 / 4;
        border-left: 1px solid #2b2f33;
        display: flex;
        flex-direction: column;
        background: #14181d;
      }
      .sidebar h2 {
        margin: 0;
        padding: 10px 12px;
        font-size: 14px;
        border-bottom: 1px solid #2b2f33;
        background: #0f1216;
      }
      .chat-log {
        flex: 1;
        overflow: auto;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .msg {
        font-size: 12px;
        line-height: 1.4;
        white-space: pre-wrap;
        padding: 7px 9px;
        border-radius: 6px;
        word-break: break-word;
      }
      .msg.user { background: #1e2f4d; }
      .msg.ai { background: #253321; }
      .chat-controls {
        border-top: 1px solid #2b2f33;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .chat-controls textarea,
      .chat-controls input,
      .chat-controls select {
        width: 100%;
        background: #0f1216;
        border: 1px solid #343a40;
        color: #e8e8e8;
        border-radius: 4px;
        padding: 5px 7px;
        font-size: 12px;
      }
      .chat-controls button {
        border: 1px solid #3f464d;
        background: #1b2026;
        color: #e8e8e8;
        border-radius: 4px;
        padding: 7px;
        cursor: pointer;
        font-size: 12px;
      }
      .chat-controls button:hover { background: #2554a8; }

      .image-ref-box {
        border: 1px dashed #3a4450;
        border-radius: 4px;
        padding: 6px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .image-ref-actions {
        display: flex;
        gap: 6px;
      }
      .image-ref-actions button {
        flex: 1;
        padding: 5px;
        font-size: 11px;
      }
      #image-ref-preview {
        width: 100%;
        max-height: 120px;
        object-fit: contain;
        border: 1px solid #2b2f33;
        border-radius: 4px;
        background: #0b0d10;
        display: none;
      }
      #image-ref-meta {
        font-size: 11px;
        color: #8aa8c0;
      }

      /* ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ */
      #cmdline-area {
        grid-column: 1 / 3;
        grid-row: 2;
        background: #0e1115;
        border-top: 1px solid #2b2f33;
        display: flex;
        flex-direction: column;
        padding: 4px 8px;
      }
      #cmdline-history {
        flex: 1;
        overflow: hidden;
        font-size: 11px;
        color: #8a9baa;
        font-family: 'Consolas', 'Courier New', monospace;
        line-height: 1.4;
      }
      #cmdline-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 2px;
      }
      #cmdline-label {
        color: #4da6ff;
        font-size: 11px;
        font-family: monospace;
        white-space: nowrap;
        min-width: 120px;
      }
      #cmdline-input {
        flex: 1;
        background: #0b0d10;
        border: 1px solid #3a4450;
        color: #e8e8e8;
        border-radius: 3px;
        padding: 3px 7px;
        font-size: 12px;
        font-family: 'Consolas', monospace;
        outline: none;
      }
      #cmdline-input:focus { border-color: #4da6ff; }

      /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
      .statusbar {
        grid-column: 1 / 3;
        grid-row: 3;
        border-top: 1px solid #2b2f33;
        background: #14181d;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 10px;
        font-size: 12px;
        gap: 16px;
      }
      #cursor-pos { color: #8aa8c0; min-width: 200px; }
      #status-tool { color: #4da6ff; }
      #status-guide { color: #8a9baa; flex: 1; text-align: center; }
      #status-snap { color: #7fd68a; min-width: 90px; text-align: right; font-family: monospace; }
      #status-modes { display: flex; gap: 10px; }
      .mode-btn {
        background: none;
        border: 1px solid #3f464d;
        color: #6a7480;
        border-radius: 3px;
        padding: 1px 6px;
        cursor: pointer;
        font-size: 11px;
      }
      .mode-btn.on { color: #4da6ff; border-color: #4da6ff; }

      /* ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
      #ctx-menu {
        position: fixed;
        background: #1a2028;
        border: 1px solid #3a4450;
        border-radius: 4px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.6);
        z-index: 1000;
        min-width: 160px;
        padding: 4px 0;
        display: none;
        font-size: 12px;
      }
      #ctx-menu.visible { display: block; }
      .ctx-item {
        padding: 6px 16px;
        cursor: pointer;
        color: #e8e8e8;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
      }
      .ctx-item:hover { background: #2554a8; }
      .ctx-item.disabled { color: #4a5560; cursor: default; }
      .ctx-item.disabled:hover { background: transparent; }
      .ctx-sep {
        height: 1px;
        background: #2b2f33;
        margin: 3px 0;
      }
      .ctx-key {
        margin-left: auto;
        color: #5a6878;
        font-size: 10px;
        font-family: monospace;
      }
      .ctx-item.disabled .ctx-key { color: #3a4450; }

      /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆ9ãƒã‚¹ï¼‰ */
      .color-palette {
        display: grid;
        grid-template-columns: repeat(9, 1fr);
        gap: 3px;
        margin: 2px 0;
      }
      .color-swatch {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 3px;
        border: 2px solid transparent;
        cursor: pointer;
        position: relative;
        box-sizing: border-box;
        min-width: 18px;
        min-height: 18px;
      }
      .color-swatch:hover { border-color: #aaa; }
      .color-swatch.active { border-color: #fff; outline: 1px solid #4da6ff; }
      .custom-swatch {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: #ccc;
        background: #2a2a2a;
        overflow: hidden;
      }
      .custom-swatch span { pointer-events: none; position: relative; z-index: 1; font-size: 11px; }

      /* çŸ©å½¢é¸æŠãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */

      .floating-dialog {
        position: fixed;
        z-index: 1100;
        background: #1c222b;
        border: 1px solid #4da6ff;
        border-radius: 6px;
        padding: 10px;
        display: none;
        min-width: 280px;
      }
      .floating-dialog .row { display:flex; gap:6px; align-items:center; margin-top:6px; }
      .floating-dialog textarea,
      .floating-dialog input,
      .floating-dialog select {
        width: 100%;
        background: #0f141a;
        border: 1px solid #3a4450;
        color: #e8e8e8;
        border-radius: 3px;
        padding: 4px;
      }
      .floating-dialog button {
        border: 1px solid #3f464d;
        background: #1b2026;
        color: #e8e8e8;
        border-radius: 3px;
        padding: 4px 8px;
        cursor: pointer;
      }

      #select-rect {
        position: absolute;
        border: 1px solid #4da6ff;
        background: rgba(77, 166, 255, 0.06);
        pointer-events: none;
        display: none;
        z-index: 10;
      }

      #layout-tabs {
        position: fixed;
        bottom: 32px;
        left: 0;
        right: 0;
        background: #1a1a1a;
        border-top: 1px solid #333;
        display: flex;
        align-items: center;
        gap: 4px;
        height: 28px;
        padding: 0 8px;
        z-index: 120;
      }
      .layout-tab {
        padding: 3px 10px;
        border: 1px solid #444;
        border-radius: 4px 4px 0 0;
        font-size: 12px;
        cursor: pointer;
      }
      .layout-tab.active { background: #2e4f7a; border-color: #4da6ff; }
      #add-layout, #add-viewport {
        border: 1px solid #444;
        background: #232323;
        color: #ddd;
        border-radius: 4px;
        width: 24px;
        height: 22px;
        cursor: pointer;
      }

      #dxf-export-dialog {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.45);
        z-index: 400;
      }
      #dxf-export-dialog.open { display: flex; }
      .dxf-export-card {
        background: #212121;
        border: 1px solid #4da6ff;
        border-radius: 8px;
        padding: 14px;
        min-width: 320px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .dxf-export-actions { display: flex; justify-content: flex-end; gap: 8px; }
    </style>
  </head>
  <body>
    <div class="layout">
      <!-- å·¦ç¸¦ãƒ„ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
      <div id="tool-panel">
        <div id="layer-panel"></div>
        <div id="symbol-library-panel"></div>
      </div>

      <!-- CADã‚­ãƒ£ãƒ³ãƒã‚¹ -->
      <div id="cad-root">
        <div id="select-rect"></div>
      </div>

      <!-- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
      <div id="ctx-menu">
        <div class="ctx-item" data-action="select-all"><span>ğŸ”²</span>ã™ã¹ã¦é¸æŠ<span class="ctx-key">Ctrl+A</span></div>
        <div class="ctx-sep"></div>
        <div class="ctx-item" data-action="copy"><span>âŠ•</span>ã‚³ãƒ”ãƒ¼<span class="ctx-key">Ctrl+C</span></div>
        <div class="ctx-item" data-action="paste"><span>ğŸ“‹</span>è²¼ã‚Šä»˜ã‘<span class="ctx-key">Ctrl+V</span></div>
        <div class="ctx-item" data-action="delete"><span>ğŸ—‘</span>å‰Šé™¤<span class="ctx-key">Del</span></div>
        <div class="ctx-sep"></div>
        <div class="ctx-item" data-action="move"><span>â†”</span>ç§»å‹•<span class="ctx-key">M</span></div>
        <div class="ctx-item" data-action="rotate"><span>â†»</span>å›è»¢<span class="ctx-key">RO</span></div>
        <div class="ctx-item" data-action="scale"><span>â‡±</span>å°ºåº¦å¤‰æ›´<span class="ctx-key">SC</span></div>
        <div class="ctx-item" data-action="mirror"><span>â‡Œ</span>é¡åƒ<span class="ctx-key">MI</span></div>
        <div class="ctx-item" data-action="offset"><span>âˆ¥</span>ã‚ªãƒ•ã‚»ãƒƒãƒˆ<span class="ctx-key">O</span></div>
        <div class="ctx-sep"></div>
        <div class="ctx-item" data-action="bring-front"><span>â¬†</span>æœ€å‰é¢ã¸</div>
        <div class="ctx-item" data-action="bring-forward"><span>â†‘</span>å‰é¢ã¸</div>
        <div class="ctx-item" data-action="send-backward"><span>â†“</span>èƒŒé¢ã¸</div>
        <div class="ctx-item" data-action="send-back"><span>â¬‡</span>æœ€èƒŒé¢ã¸</div>

        <div class="ctx-sep"></div>
        <div class="ctx-item" data-action="fit"><span>âŠ¡</span>å…¨ä½“è¡¨ç¤º<span class="ctx-key">ZA</span></div>
        <div class="ctx-item" data-action="undo"><span>â†©</span>å…ƒã«æˆ»ã™<span class="ctx-key">Ctrl+Z</span></div>
      </div>


      <div id="mtext-editor" class="floating-dialog">
        <div>MTEXTã‚¨ãƒ‡ã‚£ã‚¿</div>
        <textarea id="mtext-content" rows="6"></textarea>
        <div class="row"><label>é«˜ã•(mm)</label><input id="mtext-height" type="number" value="3.5" step="0.5" style="max-width:90px;"/><button id="mtext-bold">B</button><button id="mtext-italic">I</button></div>
        <div class="row"><button id="mtext-ok">OK</button><button id="mtext-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></div>
      </div>

      <div id="table-editor" class="floating-dialog">
        <div>TABLEã‚»ãƒ«ç·¨é›†</div>
        <div class="row"><input id="table-cell-input" type="text" /></div>
        <div class="row"><button id="table-ok">OK</button><button id="table-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></div>
      </div>

      <div id="qselect-dialog" class="floating-dialog">
        <div>ã‚¯ã‚¤ãƒƒã‚¯é¸æŠ</div>
        <div class="row"><select id="qs-type"><option value="">ã™ã¹ã¦</option><option value="line">ç·šåˆ†</option><option value="circle">å††</option><option value="rect">çŸ©å½¢</option><option value="text">æ–‡å­—</option><option value="mtext">MTEXT</option><option value="table">TABLE</option></select></div>
        <div class="row"><select id="qs-layer"><option value="">ã™ã¹ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼</option></select></div>
        <div class="row"><button id="qs-apply">é¸æŠ</button><button id="qs-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></div>
      </div>

      <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
      <aside class="sidebar">
        <div id="property-panel"></div>

        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="sidebar-tabs">
          <button class="sidebar-tab active" data-tab="chat">ğŸ¤– AIãƒãƒ£ãƒƒãƒˆ</button>
          <button class="sidebar-tab" data-tab="settings">âš™ è¨­å®š</button>
        </div>

        <!-- ãƒãƒ£ãƒƒãƒˆã‚¿ãƒ– -->
        <div id="sidebar-tab-chat" class="sidebar-tab-content active">
          <div class="chat-log" id="chat-log"></div>
          <div class="chat-controls">
            <label>ãƒ—ãƒ­ãƒã‚¤ãƒ€
              <select id="provider">
                <option value="ollama">Ollama (localhost:11434)</option>
                <option value="claude">Claude API</option>
                <option value="openai">ChatGPT (OpenAI API)</option>
                <option value="gemini">Gemini API</option>
              </select>
            </label>

            <div class="image-ref-box">
              <div id="image-ref-meta">ãƒã‚§ãƒƒã‚¯ãƒãƒƒã‚¯è³‡æ–™: ãªã—</div>
              <img id="image-ref-preview" alt="reference preview" />
              <input id="image-ref-input" type="file" accept="image/*,.pdf,application/pdf" />
              <div class="image-ref-actions">
                <button id="image-ref-clear" type="button">è³‡æ–™ã‚¯ãƒªã‚¢</button>
                <button id="apply-checkback" type="button">ãƒã‚§ãƒƒã‚¯ãƒãƒƒã‚¯åæ˜ (Î²)</button>
              </div>
            </div>

            <textarea id="chat-input" rows="3" placeholder="ã€Œç¾èª¿å†™çœŸã‹ã‚‰é–“å–ã‚Šã‚’ç°¡æ˜“ä½œå›³ã—ã¦ã€ã‚„ã€Œã“ã®ãƒã‚§ãƒƒã‚¯ãƒãƒƒã‚¯ã‚’åæ˜ ã—ã¦ã€ãªã©"></textarea>
            <button id="send-chat">é€ä¿¡ [Ctrl+Enter]</button>
          </div>
        </div>

        <!-- è¨­å®šã‚¿ãƒ– -->
        <div id="sidebar-tab-settings" class="sidebar-tab-content">
          <div class="settings-section">
            <div class="settings-title">ğŸ”‘ APIã‚­ãƒ¼è¨­å®š</div>
            <div class="settings-note">ã‚­ãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚å¤–éƒ¨ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</div>

            <label class="settings-label">Claude API Key
              <input id="claude-api-key" type="password" placeholder="sk-ant-..." autocomplete="off" />
            </label>
            <button id="save-claude-api-key" class="settings-save-btn">ä¿å­˜</button>

            <label class="settings-label">OpenAI API Key
              <input id="openai-api-key" type="password" placeholder="sk-proj-..." autocomplete="off" />
            </label>
            <button id="save-openai-api-key" class="settings-save-btn">ä¿å­˜</button>

            <label class="settings-label">Gemini API Key
              <input id="gemini-api-key" type="password" placeholder="AIza..." autocomplete="off" />
            </label>
            <button id="save-gemini-api-key" class="settings-save-btn">ä¿å­˜</button>

            <label class="settings-label">Ollama ãƒ›ã‚¹ãƒˆ
              <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" />
            </label>


            <div class="settings-title">ğŸ–¨ å‡ºå›³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ / Plot Style</div>
            <label class="settings-label">ç”¨ç´™ã‚µã‚¤ã‚º
              <select id="plot-paper-size">
                <option value="A4">A4</option>
                <option value="A3">A3</option>
                <option value="Letter">Letter</option>
              </select>
            </label>
            <label class="settings-label">å°åˆ·æ–¹å‘
              <select id="plot-orientation">
                <option value="landscape">æ¨ªå‘ã</option>
                <option value="portrait">ç¸¦å‘ã</option>
              </select>
            </label>
            <label class="settings-label">Plot Style
              <select id="plot-style">
                <option value="monochrome">monochrome.ctbï¼ˆãƒ¢ãƒã‚¯ãƒ­ï¼‰</option>
                <option value="screen">ByLayerã‚«ãƒ©ãƒ¼</option>
              </select>
            </label>
            <label class="settings-label">ç·šå¹…ã‚¹ã‚±ãƒ¼ãƒ«
              <input id="plot-lineweight-scale" type="number" min="0.1" step="0.1" value="1.0" />
            </label>

            <div class="settings-title">ğŸ“ å¯¸æ³•ã‚¹ã‚¿ã‚¤ãƒ«</div>
            <label class="settings-label">æ–‡å­—é«˜ã• (mm)
              <input id="dim-text-height" type="number" min="0.5" step="0.5" value="2.5" />
            </label>
            <label class="settings-label">çŸ¢å°ã‚µã‚¤ã‚º (mm)
              <input id="dim-arrow-size" type="number" min="0.5" step="0.5" value="2.5" />
            </label>
            <label class="settings-label">å˜ä½
              <select id="dim-unit">
                <option value="mm">mm</option>
                <option value="cm">cm</option>
                <option value="m">m</option>
              </select>
            </label>
            <label class="settings-label">å°æ•°ç‚¹ä»¥ä¸‹
              <select id="dim-precision">
                <option value="0">0æ¡ï¼ˆ1234ï¼‰</option>
                <option value="1">1æ¡ï¼ˆ1234.5ï¼‰</option>
                <option value="2">2æ¡ï¼ˆ1234.56ï¼‰</option>
              </select>
            </label>

            <div class="settings-title">ğŸ–± å³ã‚¯ãƒªãƒƒã‚¯æ“ä½œ</div>
            <label class="settings-label">ã‚³ãƒãƒ³ãƒ‰ä¸­ã®å³ã‚¯ãƒªãƒƒã‚¯
              <select id="right-click-mode">
                <option value="autocad_like">Enterç›¸å½“ï¼ˆAutoCADäº’æ›ï¼‰</option>
                <option value="legacy_cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«å„ªå…ˆï¼ˆå¾“æ¥ï¼‰</option>
              </select>
            </label>
            <div class="settings-note">ã“ã“ã§Enterç›¸å½“/ã‚­ãƒ£ãƒ³ã‚»ãƒ«å„ªå…ˆã‚’åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã™ã€‚</div>
          </div>
        </div>
      </aside>

      <!-- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ -->
      <div id="cmdline-area">
        <div id="cmdline-history"></div>
        <div id="cmdline-row">
          <span id="cmdline-label">ã‚³ãƒãƒ³ãƒ‰:</span>
          <input id="cmdline-input" type="text" placeholder="L=ç·š C=å†† REC=çŸ©å½¢ O=ã‚ªãƒ•ã‚»ãƒƒãƒˆ M=ç§»å‹• [?ã§ãƒ˜ãƒ«ãƒ—]" autocomplete="off" spellcheck="false" />
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
      <div id="layout-tabs">
        <div class="layout-tab active" data-layout="model">ãƒ¢ãƒ‡ãƒ«</div>
        <div class="layout-tab" data-layout="layout1">Layout1</div>
        <button id="add-layout" title="ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¿½åŠ ">+</button>
        <button id="add-viewport" title="ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆè¿½åŠ ">VP+</button>
      </div>

      <div class="statusbar">
        <span id="cursor-pos">X: 0 mm, Y: 0 mm</span>
        <span id="status-tool">ãƒ„ãƒ¼ãƒ«: é¸æŠ</span>
        <span id="status-guide">å›³å½¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</span>
        <span id="status-snap">SNAP: GRID</span>
        <div id="status-modes">
          <button class="mode-btn" id="btn-ortho" title="F8: ã‚ªãƒ«ã‚½ãƒ¢ãƒ¼ãƒ‰">F8 ã‚ªãƒ«ã‚½</button>
          <button class="mode-btn on" id="btn-snap" title="F9: ã‚¹ãƒŠãƒƒãƒ—">F9 ã‚¹ãƒŠãƒƒãƒ—</button>
          <button class="mode-btn on" id="btn-grid" title="F7: ã‚°ãƒªãƒƒãƒ‰">F7 ã‚°ãƒªãƒƒãƒ‰</button>
          <button class="mode-btn" id="btn-polar" title="F10: æ¥µãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°">F10 POLAR</button>
          <button class="mode-btn" id="btn-otrack" title="F11: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°">F11 OTRACK</button>
        </div>
      </div>



      <div id="units-dialog" style="display:none; position:fixed; z-index:1000; left:50%; top:50%; transform:translate(-50%,-50%); background:#2a2a2a; border:1px solid #4da6ff; padding:16px; border-radius:6px; min-width:300px;">
        <h3 style="color:#e8e8e8; margin:0 0 12px;">å˜ä½è¨­å®š</h3>
        <div style="display:grid; grid-template-columns:120px 1fr; gap:8px; align-items:center;">
          <label for="units-length-prec">é•·ã•ç²¾åº¦</label>
          <select id="units-length-prec"><option value="0">0</option><option value="1">0.0</option><option value="2">0.00</option><option value="3">0.000</option><option value="4">0.0000</option></select>
          <label for="units-angle-type">è§’åº¦å½¢å¼</label>
          <select id="units-angle-type"><option value="deg">åº¦</option><option value="dms">åº¦åˆ†ç§’</option><option value="rad">ãƒ©ã‚¸ã‚¢ãƒ³</option></select>
          <label for="units-angle-prec">è§’åº¦ç²¾åº¦</label>
          <select id="units-angle-prec"><option value="0">0</option><option value="1">0.0</option><option value="2">0.00</option><option value="3">0.000</option></select>
          <label for="units-insert">æŒ¿å…¥å˜ä½</label>
          <select id="units-insert"><option value="mm">mm</option><option value="cm">cm</option><option value="m">m</option></select>
        </div>
        <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
          <button id="units-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button id="units-ok">OK</button>
        </div>
      </div>

      <div id="quick-props" style="position:fixed; bottom:60px; left:50%; transform:translateX(-50%); background:#2a2a2a; border:1px solid #4da6ff; border-radius:6px; padding:8px 10px; display:none; z-index:200; min-width:240px; box-shadow:0 4px 18px rgba(0,0,0,.35);"></div>

      <div id="hatch-edit-dialog" style="display:none; position:fixed; z-index:1000; left:50%; top:50%; transform:translate(-50%,-50%); background:#2a2a2a; border:1px solid #4da6ff; padding:16px; border-radius:6px; min-width:280px;">
        <h3 style="color:#e8e8e8; margin:0 0 12px;">ãƒãƒƒãƒãƒ³ã‚°ç·¨é›†</h3>
        <div style="display:grid; grid-template-columns:80px 1fr; gap:8px; align-items:center;">
          <label for="hatch-pattern">ãƒ‘ã‚¿ãƒ¼ãƒ³</label>
          <select id="hatch-pattern">
            <option value="ansi31">ANSI31</option>
            <option value="cross">Cross</option>
            <option value="dots">Dots</option>
          </select>
          <label for="hatch-angle">è§’åº¦</label><input id="hatch-angle" type="number" step="1" />
          <label for="hatch-scale">ã‚¹ã‚±ãƒ¼ãƒ«</label><input id="hatch-scale" type="number" min="0.1" step="0.1" />
          <label for="hatch-color">è‰²</label><input id="hatch-color" type="color" />
        </div>
        <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
          <button id="hatch-ok">OK</button>
          <button id="hatch-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      </div>

      <div id="attr-edit-dialog" style="display:none; position:fixed; z-index:1000; left:50%; top:50%; transform:translate(-50%,-50%); background:#2a2a2a; border:1px solid #4da6ff; padding:16px; border-radius:6px; min-width:280px;">
        <h3 style="color:#e8e8e8; margin:0 0 12px;">å±æ€§ç·¨é›†</h3>
        <div id="attr-fields"></div>
        <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
          <button id="attr-ok">OK</button>
          <button id="attr-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      </div>

      <div id="dxf-export-dialog">
        <div class="dxf-export-card">
          <div>DXFæ›¸ãå‡ºã—è¨­å®š</div>
          <label>ãƒãƒ¼ã‚¸ãƒ§ãƒ³
            <select id="dxf-version">
              <option value="R12">R12</option>
              <option value="R2004" selected>R2004</option>
              <option value="R2013">R2013</option>
            </select>
          </label>
          <label>å˜ä½
            <select id="dxf-unit">
              <option value="mm" selected>ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«</option>
              <option value="m">ãƒ¡ãƒ¼ãƒˆãƒ«</option>
            </select>
          </label>
          <div class="dxf-export-actions">
            <button id="dxf-export-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button id="dxf-export-ok">æ›¸ãå‡ºã—</button>
          </div>
        </div>
      </div>
    </div>

    <script src="../node_modules/konva/konva.min.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>
